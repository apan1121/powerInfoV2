(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{108:function(t,e,a){"use strict";(function(t){var s=a(3),o=(a(120),a(381)),i=a.n(o);a(531);e.a={components:{},filters:{},props:{record:{type:Array,default:()=>[]},showVal:{type:String,default:"used"}},data:()=>({breadcrumbData:!1,lang:{used:"已發",capacity:"總容量"}}),computed:{...Object(s.c)(["PageSetting_width"])},watch:{PageSetting_width(){this.init()},record(){this.init()}},created(){},mounted(){this.init()},updated(){},destroyed(){},methods:{...Object(s.b)({}),...Object(s.d)({}),formatMoney:t=>t.toLocaleString(),init(){const e=this;e.breadcrumbData=!1;let a=t(this.$el).parents(".summary-sunburst-area").width();a>=t(this.$el).parents(".summary-sunburst-area").height()&&0!==t(this.$el).parents(".summary-sunburst-area").height()&&(a=t(this.$el).parents(".summary-sunburst-area").height()),t(this.$el).find("#sunburst-chart").height(a);new i.a({colors:{home:"#5687d1",product:"#7b615c",search:"#de783b",account:"#6ab975",other:"#a173d1",end:"#bbbbbb"},breadcrumbs_callback:(t,a,s)=>{e.breadcrumbData={breadcrumbs:t,value:a,percentage:s}}}).setData(e.record)}}}}).call(this,a(16))},381:function(t,e,a){var s,o,i,r;r=t=>{t.schemeCategory20c=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"];const e={selectors:{breadcrumbs:"#sunburst-breadcrumbs",chart:"#sunburst-chart",description:"#sunburst-description",legend:"#sunburst-legend"},width:-1,height:-1,colors:{},colorScale:t.scaleOrdinal(t.schemeCategory20c),colorScaleLength:20,breadcrumbs:{w:75,h:30,s:3,t:10},separator:"-",breadcrumbs_callback:null},a=function(t,a){this.opt=Object.assign({},e,t),this.totalSize=0,a&&this.setData(a)};return a.prototype.getColorByName=function(t){return this.opt.colors[t]||this.opt.colorScale(function(t){let e=5381,a=t.length;for(;a;)e=33*e^t.charCodeAt(--a);return e>>>0}(t)%this.opt.colorScaleLength)},a.prototype.setData=function(t){const e=this.buildHierarchy(t);this.createVisualization(e)},a.prototype.loadCsv=function(e){t.text(e).then(e=>{const a=t.csvParseRows(e),s=this.buildHierarchy(a);this.createVisualization(s)})},a.prototype.loadJson=function(e){t.json(e).then(t=>{this.createVisualization(t)})},a.prototype.createVisualization=function(e){const a=document.querySelector("#sunburst-chart");this.opt.width<0&&(this.opt.width=a.offsetWidth),this.opt.height<0&&(this.opt.height=a.offsetHeight);const s=this,o=Math.min(this.opt.width,this.opt.height)/2;t.select(this.opt.selectors.chart).select("svg").remove(),this.vis=t.select(this.opt.selectors.chart).append("svg:svg").attr("width",this.opt.width).attr("height",this.opt.height).append("svg:g").attr("id","sunburst-container").attr("transform",`translate(${this.opt.width/2},${this.opt.height/2})`);const i=t.arc().startAngle(t=>t.x0).endAngle(t=>t.x1).innerRadius(t=>Math.sqrt(t.y0)).outerRadius(t=>Math.sqrt(t.y1)),r=t.hierarchy(e).sum(t=>t.size);t.partition().size([2*Math.PI,o*o])(r),this.initializeBreadcrumbTrail(),this.drawLegend();const n=r.descendants().filter(t=>t.x1-t.x0>.001),l=this.vis.data([e]).selectAll("path").data(n).enter();l.append("svg:path").attr("display",t=>t.depth?null:"none").attr("d",i).attr("fill-rule","evenodd").style("fill",t=>s.getColorByName(t.data.name)).style("opacity",1).on("mouseover",s.mouseover.bind(this));const c=l.node();this.totalSize=c?c.__data__.value:0,t.select(this.opt.selectors.description).on("dblclick",s.resetDescription.bind(this)),s.resetDescription.bind(this)()},a.prototype.resetDescription=function(){const t=(100*this.totalSize/this.totalSize).toPrecision(3);if(this.updateDescription([],this.totalSize,t),"function"==typeof this.opt.breadcrumbs_callback){const e=[{name:"全部",value:this.totalSize,color:this.getColorByName("")}];this.opt.breadcrumbs_callback(e,this.totalSize,t)}},a.prototype.mouseover=function(t,e){if(!e)return;const a=(100*e.value/this.totalSize).toPrecision(3),s=this.getAncestors(e);this.updateDescription(s,e.value,a),this.updateBreadcrumbs(s,e.value,a),this.vis.selectAll("path").style("opacity",.3),this.vis.selectAll("path").filter(t=>s.indexOf(t)>=0).style("opacity",1)},a.prototype.mouseleave=function(e){const a=this;t.select(this.opt.selectors.breadcrumbs).select("#trail").style("visibility","hidden"),this.vis.selectAll("path").on("mouseover",null),this.vis.selectAll("path").transition().duration(1e3).style("opacity",1).on("end",(function(){t.select(this).on("mouseover",a.mouseover.bind(a))})),t.select(this.opt.selectors.description).style("visibility","hidden")},a.prototype.getAncestors=function(t){const e=[];let a=t;for(;a.parent;)e.unshift(a),a=a.parent;return e},a.prototype.initializeBreadcrumbTrail=function(){t.select(this.opt.selectors.breadcrumbs).append("svg:svg").attr("width",this.opt.width).attr("height",50).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000")},a.prototype.breadcrumbPoints=function(t,e){const a=[],s=this.opt.breadcrumbs;return a.push("0,0"),a.push(s.w+",0"),a.push(`${s.w+s.t},${s.h/2}`),a.push(`${s.w},${s.h}`),a.push("0,"+s.h),e>0&&a.push(`${s.t},${s.h/2}`),a.join(" ")},a.prototype.formatDescription=function(t,e,a){return a<.1?"< 0.1%":a+"%"},a.prototype.updateDescription=function(e,a,s){t.select(this.opt.selectors.description).html(this.formatDescription(e,a,s)).style("visibility","")},a.prototype.formatBreadcrumbText=function(t,e,a){return`${e} (${a<.1?"< 0.1%":a+"%"})`},a.prototype.updateBreadcrumbs=function(e,a,s){const o=this,i=this.opt.breadcrumbs,r=t.select("#trail").selectAll("g").data(e,t=>t.data.name+t.depth),n=r.enter().append("svg:g");if(n.append("svg:polygon").attr("points",this.breadcrumbPoints.bind(o)).style("fill",t=>o.getColorByName(t.data.name)),n.append("svg:text").attr("x",(i.w+i.t)/2).attr("y",i.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(t=>t.data.name),n.attr("transform",(t,e)=>`translate(${e*(i.w+i.s)}, 0)`),r.exit().remove(),t.select(this.opt.selectors.breadcrumbs).select("#trail").select("#endlabel").attr("x",(e.length+1)*(i.w+i.s)).attr("y",i.h/2).attr("dy","0.35em").attr("text-anchor","middle").html(this.formatBreadcrumbText(e,a,s)),t.select(this.opt.selectors.breadcrumbs).select("#trail").style("visibility",""),"function"==typeof this.opt.breadcrumbs_callback){const t=e.map(t=>({name:t.data.name,value:t.value,color:o.getColorByName(t.data.name)}));this.opt.breadcrumbs_callback(t,a,s)}},a.prototype.drawLegend=function(){const e=75,a=30,s=3,o=3,i=t.select(this.opt.selectors.legend).append("svg:svg").attr("width",e).attr("height",Object.keys(this.opt.colors).length*(a+s)).selectAll("g").data(Object.entries(this.opt.colors)).enter().append("svg:g").attr("transform",(t,e)=>`translate(0,${e*(a+s)})`);i.append("svg:rect").attr("rx",o).attr("ry",o).attr("width",e).attr("height",a).style("fill",t=>t[1]),i.append("svg:text").attr("x",e/2).attr("y",a/2).attr("dy","0.35em").attr("text-anchor","middle").text(t=>t[0])},a.prototype.buildHierarchy=function(t){const e={name:"root",children:[]};for(let s=0;s<t.length;s++){const o=t[s][0],i=+t[s][1];if(isNaN(i))continue;const r=o.split(this.opt.separator);let n=e;for(let t=0;t<r.length;t++){const e=n.children||[],s=r[t];var a;if(t+1<r.length){let t=!1;for(let o=0;o<e.length;o++)if(e[o].name==s){a=e[o],t=!0;break}t||(a={name:s,children:[]},e.push(a)),n=a}else a={name:s,size:i},e.push(a)}}return e},a},o=[a(120)],void 0===(i="function"==typeof(s=r)?s.apply(e,o):s)||(t.exports=i)},531:function(t,e,a){var s=a(532);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a(118).default)("962e3c9e",s,!1,{})},532:function(t,e,a){(t.exports=a(109)(!1)).push([t.i,"#sunburst-main{\n  position: relative;\n}\n\n#sunburst-breadcrumbs {\n    width: 600px;\n    height: 70px;\n  }\n\n  #sunburst-legend {\n    padding: 10px 0 0 3px;\n  }\n\n  #sunburst-breadcrumbs text,\n  #sunburst-legend text {\n    font-weight: 600;\n    fill: #fff;\n  }\n\n  #sunburst-chart {\n    text-align: center;\n    position: relative;\n  }\n\n  #sunburst-chart path {\n    stroke: #fff;\n  }\n\n  #sunburst-description {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 250px;\n    text-align: center;\n    font-size: 2.5em;\n    margin-left: -125px;\n    margin-top: -1.25em;\n    line-height: 2.5em;\n    overflow: hidden;\n    word-break: break-all;\n  }",""])},542:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"unit-page"},[e("news-ticker",{staticClass:"mb-3"}),t._v(" "),e("summary-box",{on:{"set-total-summary":t.setTotalSummary}}),t._v(" "),t._l(t.FormatUnitGroup,(function(a,s){return["unit-group"===a.type?[e("unit-group-box",{key:a.group_name,attrs:{"group-name":a.group_name,"total-break":a.total_break,"total-fixed":a.total_fixed,"total-limit":a.total_limit,"total-capacity":a.total_capacity,"total-used":a.total_used,"acc-total-used":a.accTotalUsed,"last-acc-total-used":void 0!==t.FormatUnitGroup[s+1]&&t.FormatUnitGroup[s+1].accTotalUsed,units:a.units}})]:t._e(),t._v(" "),"unit-ads"===a.type?[e("unit-group-ads-box",{key:s+"_Ads",attrs:{"group-name":"廣告","total-break":a.total_break,"total-fixed":a.total_fixed,"total-limit":a.total_limit,"total-capacity":a.total_capacity,"total-used":a.total_used,"acc-total-used":a.accTotalUsed,"last-acc-total-used":void 0!==t.FormatUnitGroup[s+1]&&t.FormatUnitGroup[s+1].accTotalUsed}})]:t._e()]})),t._v(" "),t.choosePlantName?[e("plant-info-box",{attrs:{"plant-name":t.choosePlantName},on:{close:t.closePlantInfo}})]:t._e(),t._v(" "),t.chooseUnitKey?[e("unit-info-box",{attrs:{"unit-key":t.chooseUnitKey},on:{close:t.closeUnitInfo}})]:t._e(),t._v(" "),t.openFilterFlag?[e("unit-filter-box",{attrs:{type:!0,sort:!0},on:{"open-filter-box":t.openFilterBoxAct}})]:t._e()],2)};s._withStripped=!0;var o=a(2),i=a(3),r=a(390),n=a(391),l=a(15);a(34).a;const c={openFilterBox(t,e){t.openFilterFlag=!!e}};const p={state:()=>({openFilterFlag:!1}),mutations:c,actions:{},getters:{openFilterFlag:t=>t.openFilterFlag},namespaced:!0};var u=function(){var t=this,e=t._self._c;return e("pipe-group-box",{attrs:{"direction-top":!0,"direction-right":!0,"pipe-top":!1,"pipe-bottom":t.TotalUsed,"pipe-right":t.TotalUsed},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",{staticClass:"summary-box"},[e("div",{staticClass:"filter-area"},[e("button",{staticClass:"btn btn-secondary btn-sm",attrs:{type:"button"},on:{click:t.openFilter}},[e("i",{staticClass:"fas fa-filter"})]),t._v(" "),e("span",{staticClass:"filter-info"},[t._v("\n                    選取 "),e("b",[t._v(t._s(t.chooseTypes.length))]),t._v(" 種發電類型，"),e("b",[t._v(t._s(t.sortGroup.length))]),t._v(" 項排序\n                ")])]),t._v(" "),e("div",{staticClass:"last-updated-time"},[t._v("\n                最後更新時間: "+t._s(t.RecordTime)+"\n            ")]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-4"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm-6 col-md-12"},[e("div",{staticClass:"summary-info-area"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box"},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.TotalUsed)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t._f("formatMoney")(t.TotalUsed))+" "),e("small",[t._v("MW")])])])]),t._v(" "),e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box"},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.TotalCapacity)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t._f("formatMoney")(t.TotalCapacity))+" "),e("small",[t._v("MW")])])])]),t._v(" "),e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box"},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.TotalPercent)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t.TotalPercent)+" "),e("small",[t._v("%")])])])])])])]),t._v(" "),e("div",{staticClass:"col-12 col-sm-6 col-md-12"},[e("div",{staticClass:"summary-info-area"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box",attrs:{rel:"fix"}},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.UnitFixed)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t._f("formatMoney")(t.UnitFixed))+" "),e("small",[t._v("MW")])])])]),t._v(" "),e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box",attrs:{rel:"limit"}},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.UnitLimit)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t._f("formatMoney")(t.UnitLimit))+" "),e("small",[t._v("MW")])])])]),t._v(" "),e("div",{staticClass:"col-12"},[e("div",{staticClass:"summary-info-box",attrs:{rel:"break"}},[e("div",{staticClass:"summary-info-title"},[t._v("\n                                                "+t._s(t.lang.summaryBox.UnitBreak)+"\n                                            ")]),t._v(" "),e("div",{staticClass:"summary-info-content"},[t._v("\n                                                "+t._s(t._f("formatMoney")(t.UnitBreak))+" "),e("small",[t._v("MW")])])])])])])])])]),t._v(" "),e("div",{staticClass:"col-12 col-md-8"},[e("div",{staticClass:"summary-sunburst-area"},[t.SunburstRecord?[e("summary-sunburst-box",{attrs:{record:t.SunburstRecord,"show-val":t.showVal}})]:t._e()],2)])])])]},proxy:!0}])})};u._withStripped=!0;var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pipe-group"},[e("div",{staticClass:"pipe-wrapper"},[!1!==t.pipeTop?e("pipe",{staticClass:"pipe-top",attrs:{vertical:!0,direction:t.directionTop?"up":"down",used:t.pipeTop}}):t._e(),t._v(" "),!1!==t.pipeRight?e("pipe",{staticClass:"pipe-right",attrs:{vertical:!1,direction:t.directionRight?"up":"down",used:t.pipeRight}}):t._e(),t._v(" "),!1!==t.pipeBottom?e("pipe",{staticClass:"pipe-bottom",attrs:{vertical:!0,direction:t.directionTop?"up":"down",used:t.pipeBottom}}):t._e()],1),t._v(" "),e("div",{staticClass:"pipe-group-content"},[e("div",{staticClass:"unit-group-box",class:{show:t.collapse}},[t.hasTitleSlot?e("div",{staticClass:"unit-group-header",on:{click:t.collapseToggle}},[t._t("title")],2):t._e(),t._v(" "),e("div",{staticClass:"unit-group-content"},[t._t("content")],2)])])])};d._withStripped=!0;var m={components:{Pipe:()=>Promise.all([a.e(7),a.e(0),a.e(19)]).then(a.bind(null,553))},filters:{},props:{pipeTop:{type:[Boolean,Number],default:!1},pipeRight:{type:[Boolean,Number],default:!1},pipeBottom:{type:[Boolean,Number],default:!1},directionTop:{type:Boolean,default:!0},directionRight:{type:Boolean,default:!0},groupName:{type:String,default:""}},data:()=>({collapse:!0}),computed:{...Object(i.c)([]),hasTitleSlot(){return!!this.$slots.title}},watch:{collapse(){o.f.gtag("event","PipeGroupBox",{groupName:this.groupName,collapse:this.collapse}),o.f.mixpanel("PipeGroupBox_collapse",{groupName:this.groupName,collapse:this.collapse})}},created(){},mounted(){},updated(){},destroyed(){},methods:{...Object(i.b)({}),...Object(i.d)({}),collapseToggle(){this.collapse=!this.collapse}}},h=a(4),y=Object(h.a)(m,d,[],!1,null,"0bbd76a8",null).exports,b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"summary-sunburst-box"},[e("div",{attrs:{id:"sunburst-main"}},[e("div",{staticClass:"sunburst-breadcrumbs"},[t.breadcrumbData?[t._l(t.breadcrumbData.breadcrumbs,(function(a,s){return[e("span",{key:s,staticClass:"breadcrumb-item",domProps:{textContent:t._s(a.name)}})]})),t._v("\n                :\n                "),e("span",[e("small",[t._v(t._s(t.lang[t.showVal]))]),t._v("  "+t._s(t.formatMoney(t.breadcrumbData.value))+" "),e("small",[t._v("MW")])]),t._v(" "),e("span",[t._v("("+t._s(t.breadcrumbData.percentage)+" "),e("small",[t._v("%")]),t._v(")")])]:t._e()],2),t._v(" "),t._m(0)])])};b._withStripped=!0;var f=a(108).a,_={components:{PipeGroupBox:y,SummarySunburstBox:Object(h.a)(f,b,[function(){var t=this._self._c;return t("div",{attrs:{id:"sunburst-chart"}},[t("div",{attrs:{id:"sunburst-description"}})])}],!1,null,"47532823",null).exports},filters:{formatMoney:t=>t.toLocaleString()},props:{},data:()=>({TotalCapacity:0,TotalUsed:0,UnitFixed:0,UnitLimit:0,UnitBreak:0,SunburstRecord:!1}),computed:{...Object(i.c)({lang:"lang",chooseTypes:"chooseTypes",RecordTime:"RecordTime",FormatUnits:"FormatUnits",sortGroup:"sortGroup",showVal:"showVal"}),TotalPercent(){let t=0;return this.TotalCapacity>0&&(t=this.TotalUsed/this.TotalCapacity*100,t=t.toFixed(2)),t}},watch:{FormatUnits:{handler(){this.calc()}},chooseTypes:{handler(){this.calc()}}},created(){},mounted(){},updated(){},destroyed(){},methods:{...Object(i.b)({}),...Object(i.d)({openFilterBox:"Page/UnitPage/openFilterBox"}),calc(){const t=this;clearTimeout(t.calcTimer),t.calcTimer=setTimeout(()=>{let e=0,a=0,s=0,o=0,i=0;const r={},n=JSON.parse(JSON.stringify(t.FormatUnits));Object.values(n).forEach(n=>{if(!t.chooseTypes.includes(n.orgType))return!1;switch(n.orgStatus){case"fix":s+=n.capacity;break;case"break":i+=n.capacity;break;case"limit":o+=n.capacity;break;case"online":e+=n.capacity,a+=n.used}let l=t.sortGroup.map(t=>n[t]);l=l.join("-"),r[l]||(r[l]=0),n[t.showVal]>0&&(r[l]+=n[t.showVal])}),t.TotalCapacity=e,t.TotalUsed=a,t.UnitFixed=s,t.UnitBreak=i,t.UnitLimit=o;let l=[];for(const t in r)l.push([t,r[t]]);l=l.sort((t,e)=>t[1]<e[1]?1:t[1]===e[1]?0:-1),t.SunburstRecord=l,t.$emit("set-total-summary",{TotalCapacity:e,TotalUsed:a,TotalPercent:t.TotalPercent,UnitFixed:s,UnitBreak:i,UnitLimit:o})},100)},openFilter(){this.openFilterBox(!0)}}},g=Object(h.a)(_,u,[],!1,null,"41a28b11",null).exports,v=function(){var t=this,e=t._self._c;return e("pipe-group-box",{attrs:{"direction-top":!0,"direction-right":!1,"pipe-top":t.accTotalUsed,"pipe-bottom":t.lastAccTotalUsed,"pipe-right":t.totalUsed,"group-name":t.groupName},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("\n        "+t._s(t.groupName)+"\n    ")]},proxy:!0},{key:"content",fn:function(){return[e("div",{staticClass:"unit-group-info"},[t._v("\n            發電量(已/可)：\n            "+t._s(t._f("formatMoney")(t.totalUsed))+" "),e("small",[t._v("MW")]),t._v("\n            /\n            "+t._s(t._f("formatMoney")(t.totalCapacity))+" "),e("small",[t._v("MW")]),t._v(" "),e("span",{staticClass:"label",class:t.usedPercentColor},[t._v(t._s(t.usedPercent)),e("small",[t._v("%")])])]),t._v(" "),e("div",{staticClass:"unit-group-info"},[t.totalFixed>0?e("div",{staticClass:"unit-group-label",attrs:{rel:"fix"}},[t._v("\n                待修機組： "+t._s(t._f("formatMoney")(t.totalFixed))+" "),e("small",[t._v("MW")])]):t._e(),t._v(" "),t.totalBreak>0?e("div",{staticClass:"unit-group-label",attrs:{rel:"break"}},[t._v("\n                故障機組： "+t._s(t._f("formatMoney")(t.totalBreak))+" "),e("small",[t._v("MW")])]):t._e(),t._v(" "),t.totalLimit>0?e("div",{staticClass:"unit-group-label",attrs:{rel:"limit"}},[t._v("\n                限轉機組： "+t._s(t._f("formatMoney")(t.totalLimit))+" "),e("small",[t._v("MW")])]):t._e()]),t._v(" "),e("div",{staticClass:"row"},[t._l(t.units,(function(a,s){return[e("div",{key:`${t.groupName}-${s}`,staticClass:"col-6 col-md-4 col-lg-3 col-xl-2 text-center"},[e("unit-box",{attrs:{"unit-key":a.key,name:a.name,"org-type":a.orgType,"org-status":a.orgStatus,"plant-name":a.plantName,"plant-full-name":a.plantFullName,used:a.used,capacity:a.capacity},on:{"open-plant":t.openPlantInfo,"open-unit":t.openUnitInfo}})],1)]}))],2)]},proxy:!0}])})};v._withStripped=!0;var x={components:{PipeGroupBox:y,UnitBox:()=>Promise.all([a.e(5),a.e(0),a.e(20)]).then(a.bind(null,536))},filters:{formatMoney:t=>t.toLocaleString()},props:{groupName:{type:String,default:"未命名"},totalBreak:{type:Number,default:0},totalFixed:{type:Number,default:0},totalLimit:{type:Number,default:0},totalCapacity:{type:Number,default:0},totalUsed:{type:Number,default:0},accTotalUsed:{type:Number,default:0},lastAccTotalUsed:{type:[Number,Boolean],default:0},units:{type:Array,default:()=>[]}},data:()=>({}),computed:{...Object(i.c)([]),usedPercent(){let t=0;return 0!==this.totalCapacity&&(t=this.totalUsed/this.totalCapacity*100),t=t.toFixed(2),t},usedPercentColor(){const t=this.usedPercent+0;let e="";return e=t>90?"label-danger":t>80?"label-warning":0===t?"label-default":t<0?"label-info":"label-success",e}},watch:{},created(){},mounted(){},updated(){},destroyed(){},methods:{...Object(i.b)({}),...Object(i.d)({choosePlantByName:"choosePlantByName",chooseUnitByKey:"chooseUnitByKey"}),openPlantInfo(t){this.choosePlantByName(t)},openUnitInfo(t){this.$router.push({name:"UnitPage",query:{unit_key:this.unitKey}})}}},T=Object(h.a)(x,v,[],!1,null,"51b0a900",null).exports,U=function(){var t=this,e=t._self._c;return e("pipe-group-box",{attrs:{"direction-top":!0,"direction-right":!1,"pipe-top":t.accTotalUsed,"pipe-bottom":t.lastAccTotalUsed,"pipe-right":t.totalUsed},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("\n        "+t._s(t.groupName)+"\n    ")]},proxy:!0},{key:"content",fn:function(){return[e("div",{ref:"ads",staticClass:"power-info-promote",class:{"ad-blocked":t.adBlocked}},[e("ins",{staticClass:"adsbygoogle",staticStyle:{display:"block"},attrs:{"data-ad-format":"fluid","data-ad-layout-key":"-fb+5w+4e-db+86","data-ad-client":"ca-pub-3068501078221920","data-ad-slot":"1897408904"}})])]},proxy:!0}])})};U._withStripped=!0;var C={components:{PipeGroupBox:y},filters:{},props:{groupName:{type:String,default:"未命名"},totalUsed:{type:Number,default:0},accTotalUsed:{type:Number,default:0},lastAccTotalUsed:{type:[Number,Boolean],default:0}},data:()=>({}),computed:{...Object(i.c)(["adBlocked"])},watch:{},created(){},mounted(){this.$nextTick(()=>{(window.adsbygoogle=window.adsbygoogle||[]).push({})})},updated(){},destroyed(){},methods:{...Object(i.b)({}),...Object(i.d)({})}},w=Object(h.a)(C,U,[],!1,null,"63f8ce14",null).exports;o.b.register([{rel:"stylesheet",type:"text/css",href:"/dist/css/page/unit-page.css"}]);var B={components:{NewsTicker:()=>a.e(15).then(a.bind(null,549)),UnitFilterBox:()=>Promise.all([a.e(6),a.e(0)]).then(a.bind(null,550)),PlantInfoBox:r.a,SummaryBox:g,UnitGroupBox:T,UnitInfoBox:n.default,UnitGroupAdsBox:w},filters:{},mixins:[l.a],props:{},data:()=>({FormatUnitGroup:[],TotalSummary:!1}),computed:{...Object(i.c)({lang:"lang",RecordTime:"RecordTime",sortGroup:"sortGroup",FormatUnits:"FormatUnits",MappingPlantList:"MappingPlantList",choosePlantName:"choosePlantName",choosePlantInfo:"choosePlantInfo",chooseUnitKey:"chooseUnitKey",openFilterFlag:"Page/UnitPage/openFilterFlag",chooseTypes:"chooseTypes"}),route(){return this.$route||!1}},watch:{sortGroup:{immediate:!1,handler(){this.calcFormatUnitGroup()}},chooseTypes:{immediate:!1,handler(){this.calcFormatUnitGroup()}},FormatUnits:{immediate:!1,handler(){this.calcFormatUnitGroup()}},TotalSummary:{immediate:!0,deep:!0,handler(){this.setSEO()}}},beforeCreate(){this.$store.state["Page/UnitPage"]||this.$store.registerModule(["Page/UnitPage"],p)},created(){},mounted(){this.setSEO(),this.route&&this.route.query&&this.route.query.unit_key&&this.chooseUnitByKey(this.route.query.unit_key),this.route&&this.route.query&&this.route.query.plant_name&&this.choosePlantByName(this.route.query.plant_name),this.init(),o.f.gtag("event","page_view",{page_id:"UnitPage"}),o.f.mixpanel("page_view",{page_id:"UnitPage"})},updated(){},destroyed(){},methods:{...Object(i.b)({}),...Object(i.d)({choosePlantByName:"choosePlantByName",chooseUnitByKey:"chooseUnitByKey",openFilterBox:"Page/UnitPage/openFilterBox"}),setSEO(){const t=this;clearTimeout(t.setSEOTimer),t.setSEOTimer=setTimeout(()=>{let e=[];if(t.TotalSummary)for(const a in t.TotalSummary)if(t.TotalSummary[a]>0){const s=t.TotalSummary[a].toLocaleString();"TotalPercent"===a?e.push(`${t.lang.summaryBox[a]} ${s} %`):e.push(`${t.lang.summaryBox[a]} ${s} MW`)}e=e.join("，");let a=[];for(const e of t.FormatUnitGroup)e.group_name.includes("ads")||a.push(e.group_name);a=a.join("、"),t.setPageSEO({title:"機組資訊",description:`最後更新時間為 ${t.RecordTime}，${e}，發電機組包含了${a}。`})},200)},setTotalSummary(t){this.TotalSummary={TotalCapacity:0,TotalUsed:0,TotalPercent:0,UnitBreak:0,UnitFixed:0,UnitLimit:0,...t}},init(){this.loadPlantInfo()},loadPlantInfo(){const t=this;o.d.loading({title:"讀取中"}),t.$store.dispatch("getPlantInfo").then(e=>{t.loadPowerInfo()},()=>{o.d.close()})},loadPowerInfo(){o.d.loading({title:"讀取中"}),this.$store.dispatch("getRealTimePowerInfo").then(t=>{o.d.close()},()=>{o.d.close()})},calcFormatUnitGroup(){const t=this;clearTimeout(t.calcFormatUnitGroupTimer),t.calcFormatUnitGroupTimer=setTimeout(()=>{const e=JSON.parse(JSON.stringify(t.sortGroup)),a=JSON.parse(JSON.stringify(t.FormatUnits)),s=JSON.parse(JSON.stringify(t.lang)),{status:i,type:r,locations:n,plantNames:l}=s,c=t._formatKeyMapping(i),p=t._formatKeyMapping(r),u=t._formatKeyMapping(n),d=t._formatKeyMapping(l);let m={};Object.values(a).forEach(a=>{if(!t.chooseTypes.includes(a.orgType))return!0;let s=[];e.forEach(t=>{switch(t){case"gov":"1"===a.orgGov?s.push("0000"):s.push("0999");break;case"location":void 0!==u[a.location]?s.push(u[a.location]):s.push("0999");break;case"plantName":void 0!==d[a.plantName]?s.push(d[a.plantName]):s.push(("________________________"+a[t]).substr(-10));break;case"type":void 0!==p[a.orgType]?s.push(p[a.orgType]||"9999"):s.push("0999");break;case"status":void 0!==c[a.orgStatus]?s.push(c[a.orgStatus]||"9999"):s.push("0999");break;default:s.push(("________________________"+a[t]).substr(-10))}}),s=s.join("-"),m[s]||(m[s]=[]);const o={};return["name","gov","type","typeGroup","orgType","orgStatus","location","plantName","plantFullName","used","capacity","key"].forEach(t=>{o[t]=a[t]}),m[s].push(o),!0}),m=o.e.sortObject(m);const h=e[0],y={};for(const t in m){const e=m[t][0][h];void 0===y[e]&&(y[e]=[]),y[e]=y[e].concat(m[t])}const b={},f=[];for(const t in y){const e=y[t];let a=0,s=0,o=0,i=0,r=0;e.forEach(t=>{switch(b[t.orgType]=1,t.orgStatus){case"fix":o+=t.capacity;break;case"break":r+=t.capacity;break;case"limit":i+=t.capacity;break;case"online":a+=t.capacity,s+=t.used}}),f.push({group_name:t,type:"unit-group",units:e,total_capacity:a,total_used:s,total_fixed:o,total_limit:i,total_break:r}),f.length%5==3&&f.push({group_name:"ads_"+t,type:"unit-ads",units:[],total_capacity:0,total_used:0,total_fixed:0,total_limit:0,total_break:0})}for(let t=f.length-1;t>=0;t--){let e=0;f[t+1]&&(e=f[t+1].accTotalUsed),f[t].accTotalUsed=e+f[t].total_used}t.FormatUnitGroup=f},100)},_formatKeyMapping(t){const e={};if(Array.isArray(t))t.forEach((t,a)=>{e[t]=("0000"+a).substr(-4)});else{Object.keys(t).forEach((t,a)=>{e[t]=("0000"+a).substr(-4)})}return e},closePlantInfo(){this.choosePlantByName("")},closeUnitInfo(){this.chooseUnitByKey("")},openFilterBoxAct(t){this.openFilterBox(t)}}},k=Object(h.a)(B,s,[],!1,null,"e6efae3e",null);e.default=k.exports}}]);